<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="fs-4">Business Categories</h3>
  </div>
  <div class="card-body">
    <!-- Add Business Category Form -->
    <form (ngSubmit)="createCategory()" #catForm="ngForm" novalidate class="mb-4">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="catName" class="form-label fw-semibold">Name</label>
          <input
            type="text"
            id="catName"
            class="form-control"
            name="name"
            [(ngModel)]="newCategory.name"
            #nameModel="ngModel"
            required
            placeholder="e.g. Retail, Electronics"
            [class.is-invalid]="nameModel.invalid && nameModel.touched"
          />
          <div class="invalid-feedback" *ngIf="nameModel.invalid && nameModel.touched">
            Name is required.
          </div>
        </div>

        <div class="col-md-6">
          <label for="catStatus" class="form-label fw-semibold">Status</label>
          <select
            id="catStatus"
            class="form-select"
            name="status"
            [(ngModel)]="newCategory.status"
          >
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>

        <!-- <div class="col-12">
          <label for="catDesc" class="form-label fw-semibold">Description</label>
          <textarea
            id="catDesc"
            class="form-control"
            name="description"
            [(ngModel)]="newCategory.description"
            rows="2"
            placeholder="Optional description"
          ></textarea>
        </div> -->
      </div>

      <div class="mt-4 text-end">
        <button type="submit" class="btn btn-primary primary" [disabled]="catForm.invalid">
          Add Category
        </button>
      </div>
    </form>

    <!-- Categories List -->
    <div class="table-responsive table-bordered">
      <div class="card-header d-flex justify-content-between align-items-center mb-2">
        <h3 class="mb-0">Categories List</h3>
        <span class="small text-success fw-semibold">{{ totalItems }} Total</span>
      </div>

      <table class="table table-striped table-hover text-center">
        <thead>
          <tr>
            <th scope="col">S.No</th>
            <th scope="col">Name</th>
            <!-- <th scope="col">Description</th> -->
            <th scope="col">Status</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cat of categories; let i = index">
            <th scope="row">{{ (currentPage - 1) * limit + i + 1 }}</th>
            <td>{{ cat.name }}</td>
            <!-- <td>{{ cat.description || '-' }}</td> -->
            <td>
              <span
                class="badge"
                [ngClass]="{
                  'bg-success': cat.status === 'active',
                  'bg-danger': cat.status === 'inactive'
                }"
              >
                {{ cat.status | titlecase }}
              </span>
            </td>
            <td>
              <div class="btn-group" role="group">
                <!-- Status Toggle Button -->
                <button
                  type="button"
                  class="btn btn-sm"
                  [ngClass]="{
                    'btn-btn-outline-success': cat.status === 'inactive',
                    'btn-outline-secondary': cat.status === 'active'
                  }"
                  (click)="toggleStatus(cat)"
                  title="{{ cat.status === 'active' ? 'Set Inactive' : 'Set Active' }}"
                >
                  <i class="cil-sync"></i>
                </button>

                <!-- Delete Button -->
                <button
                  type="button"
                  class="btn btn-sm btn-outline-danger"
                  (click)="deleteCategory(cat._id!)"
                  title="Delete"
                >
                  <i class="cil-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="categories.length === 0">
            <td colspan="5" class="text-center text-muted">No categories found.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination Controls -->
    <nav *ngIf="totalPages > 1" class="mt-3" aria-label="Pagination">
      <ul class="pagination justify-content-end mb-0">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button
            class="page-link"
            (click)="changePage(currentPage - 1)"
            [disabled]="currentPage === 1"
          >
            Previous
          </button>
        </li>

        <li
          class="page-item"
          *ngFor="let _ of [].constructor(totalPages); let idx = index"
          [class.active]="currentPage === idx + 1"
        >
          <button class="page-link" (click)="changePage(idx + 1)">
            {{ idx + 1 }}
          </button>
        </li>

        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button
            class="page-link"
            (click)="changePage(currentPage + 1)"
            [disabled]="currentPage === totalPages"
          >
            Next
          </button>
        </li>
      </ul>
    </nav>
  </div>
</div>

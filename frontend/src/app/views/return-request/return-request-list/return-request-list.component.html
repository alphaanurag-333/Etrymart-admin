<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3>Return Requests</h3>
  </div>

  <div class="card-body">
    <!-- Search & Filter -->
    <div class="mb-3 d-flex justify-content-between align-items-center">
      <input
        type="text"
        class="form-control w-25 mx-3"
        placeholder="Search by user, seller, order, reason..."
        [(ngModel)]="searchText"
        (keyup)="loadRequests()"
      />

      <select class="form-control w-25 mx-3" [(ngModel)]="selectedStatus" (change)="loadRequests()">
        <option value="">All Status</option>
        <option value="Pending">Pending</option>
        <option value="Approved">Approved</option>
        <option value="Denied">Denied</option>
      </select>
    </div>

    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-bordered table-striped" *ngIf="requests.length > 0; else noData">
        <thead>
          <tr>
            <th>#</th>
            <th>User</th>
            <th>Seller</th>
            <th>Order</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let req of requests; let i = index">
            <td>{{ offset + i + 1 }}</td>
            <td>{{ req.user_id?.name }} <br /><small>{{ req.user_id?.mobile }}</small></td>
            <td>{{ req.seller_id?.shop_name || '-' }} <br /><small>{{ req.seller_id?.mobile }}</small></td>
            <td>Order #{{ req.order_id?.order_id }} <br /><small>â‚¹{{ req.order_id?.total_price }}</small></td>
            <td>{{ req.reason }}</td>
            <td>
              <span
                class="badge"
                [ngClass]="{
                  'bg-warning': req.status === 'Pending',
                  'bg-success': req.status === 'Approved',
                  'bg-danger': req.status === 'Denied'
                }"
              >
                {{ req.status }}
              </span>
            </td>
            <td>
              <button class="btn btn-sm btn-primary me-1" (click)="viewRequest(req._id)">View</button>
              <!-- <button *ngIf="req.status === 'Pending'" class="btn btn-sm btn-success me-1" (click)="updateStatus(req._id, 'Approved')">
                Approve
              </button>
              <button *ngIf="req.status === 'Pending'" class="btn btn-sm btn-danger" (click)="updateStatus(req._id, 'Denied')">
                Deny
              </button> -->
            </td>
          </tr>
        </tbody>
      </table>

      <ng-template #noData>
        <div class="alert alert-info">No return requests found.</div>
      </ng-template>
    </div>

    <!-- Pagination -->
    <nav *ngIf="totalPages > 1" aria-label="Return Requests Pagination" class="mt-3">
      <ul class="pagination justify-content-end">
        <li class="page-item" [class.disabled]="currentPage === 1" (click)="prevPage()">
          <a class="page-link" href="javascript:void(0)">Previous</a>
        </li>
        <li
          class="page-item"
          *ngFor="let page of [].constructor(totalPages); let idx = index"
          [class.active]="currentPage === idx + 1"
          (click)="goToPage(idx + 1)"
        >
          <a class="page-link" href="javascript:void(0)">{{ idx + 1 }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages" (click)="nextPage()">
          <a class="page-link" href="javascript:void(0)">Next</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<div class="container mt-4">
  <h4 class="fw-bold mb-4">Withdrawal Requests</h4>

  <!-- Filter Panel -->
  <div class="card shadow-sm p-4 mb-4">
    <div class="row g-3 align-items-end">

      <!-- Search (Left) -->
      <div class="col-md-6">
        <label class="form-label">Search</label>
        <input type="text" class="form-control" [(ngModel)]="search" (ngModelChange)="fetchRequests()"
          placeholder="Search by amount or status" />
      </div>

      <!-- Status Filter (Right) -->
      <div class="col-md-3 offset-md-3">
        <label class="form-label">Filter by Status</label>
        <select class="form-select" [(ngModel)]="statusFilter" (ngModelChange)="fetchRequests()">
          <option value="">All</option>
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>

    </div>
  </div>

  <!-- Requests Table -->
  <div class="table-responsive" *ngIf="requests.length > 0">
    <table class="table align-middle table-bordered shadow-sm rounded">
      <thead class="bg-light text-muted border-bottom">
        <tr>
          <th>SL</th>
          <th>Seller</th>
          <th>Email</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Requested At</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let req of requests; let i = index" class="bg-white">
          <td>{{ (page - 1) * limit + i + 1 }}</td>
          <td>{{ req.seller_id?.name || 'N/A' }}</td>
          <td>{{ req.seller_id?.email || 'N/A' }}</td>
          <td>â‚¹{{ req.amount | number: '1.2-2' }}</td>
          <td>
            <span class="badge rounded-pill px-3 py-1" [ngClass]="{
              'bg-primary text-dark': req.status === 'pending',
              'bg-success': req.status === 'approved',
              'bg-danger': req.status === 'rejected'
            }">
              {{ req.status }}
            </span>
          </td>
          <td>{{ req.requested_at | date: 'dd MMM yyyy, hh:mm a' }}</td>
          <td class="d-flex gap-2">
            <a [routerLink]="[req._id]" class="btn btn-outline-primary btn-sm" title="View">
              <i class="far fa-eye"></i>
            </a>
            <button *ngIf="req.status === 'pending'" class="btn btn-outline-success btn-sm"
              (click)="updateStatus(req._id, 'approved')">
              Approve
            </button>
            <button *ngIf="req.status === 'pending'" class="btn btn-outline-danger btn-sm"
              (click)="updateStatus(req._id, 'rejected')">
              Reject
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- No Requests Message -->
  <div *ngIf="requests.length === 0" class="text-center text-muted mt-3">
    No withdrawal requests found.
  </div>

  <!-- Pagination -->
  <nav *ngIf="totalPages > 1" class="mt-4">
    <ul class="pagination justify-content-end">
      <li class="page-item" [class.disabled]="page === 1">
        <button class="page-link" (click)="changePage(page - 1)">Previous</button>
      </li>
      <li class="page-item" *ngFor="let pg of [].constructor(totalPages); let idx = index"
        [class.active]="page === idx + 1">
        <button class="page-link" (click)="changePage(idx + 1)">{{ idx + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="page === totalPages">
        <button class="page-link" (click)="changePage(page + 1)">Next</button>
      </li>
    </ul>
  </nav>
</div>
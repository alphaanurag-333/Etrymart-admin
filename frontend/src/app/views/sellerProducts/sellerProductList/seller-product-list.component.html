<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="fs-4">Product Management</h3>
  </div>

  <div class="card-body">
    <div class="table-responsive table-bordered text-center">
      <div class="mb-3 d-flex justify-content-between align-items-center">
        <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()"
          class="form-control w-25 mx-3 mt-2 border border-outline-primary" placeholder="Search by product name" />
        <select class="form-select w-25 mx-3 mt-2" [(ngModel)]="requestStatusFilter" (change)="onSearchChange()">
          <option value="">All Request Status</option>
          <option value="0">Pending</option>
          <option value="1">Approved</option>
          <option value="2">Denied</option>
        </select>

        <button class="btn btn-primary primary mx-3 mt-2" routerLink="/admin/products/add">
          Add New Product
        </button>
      </div>

      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>#</th>
            <th>Thumbnail</th>
            <th>Name</th>
            <th>Price</th>
            <th>Status</th>
            <th>Request Status</th>
            <th>Offer</th>
            <th>Trending</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of products; let i = index">
            <td>{{ offset + i + 1 }}</td>
            <td>
              <span class="table-img">
                <img [src]="product.thumbnail" class="img-thumbnail" />
              </span>
            </td>
            <td>{{ product.name }}</td>
            <td>{{ product.unit_price }}</td>
            <td>
              <span class="badge" [ngClass]="{
                  'bg-success': product.status === 1,
                  'bg-danger': product.status === 0
                }">
                {{ product.status === 1 ? "Active" : "Inactive" }}
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="{
    'bg-info': product.request_status === 0,
    'bg-success': product.request_status === 1,
    'bg-danger': product.request_status === 2
  }">
                {{ product.request_status === 0 ? 'Pending' : product.request_status === 1 ? 'Approved' : 'Denied' }}
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="{
    'bg-success': product.is_offers,
    'bg-secondary': !product.is_offers
  }">
                {{ product.is_offers ? 'Yes' : 'No' }}
              </span>
            </td>

            <td>
              <span class="badge" [ngClass]="{
    'bg-warning text-dark': product.is_trending,
    'bg-secondary': !product.is_trending
  }">
                {{ product.is_trending ? 'Yes' : 'No' }}
              </span>
            </td>



            <td>
              <div class="btn-group" role="group">
                <button class="btn btn-sm btn-outline-primary primaryout"
                  [routerLink]="['/admin/seller-products/view', product._id]" title="View">
                  <i class="far fa-eye fs-6"></i>
                </button>
                <!-- <button class="btn btn-sm btn-outline-warning"
                  [routerLink]="['/admin/seller-products/edit', product._id]" title="Edit">
                  <i class="cil-pencil"></i>
                </button> -->
                <button class="btn btn-sm btn-outline-secondary" (click)="toggleStatus(product)" title="Toggle Status">
                  <i class="cil-sync"></i>
                </button>
                <!-- Toggle Offer -->
                <button class="btn btn-sm"
                  [ngClass]="product.is_offers ? 'btn-outline-success' : 'btn-outline-secondary'"
                  (click)="toggleOffer(product)" title="Toggle Offer">
                  <i class="fas fa-tag"></i>
                </button>

                <!-- Toggle Trending -->
                <button class="btn btn-sm"
                  [ngClass]="product.is_trending ? 'btn-outline-warning' : 'btn-outline-secondary'"
                  (click)="toggleTrending(product)" title="Toggle Trending">
                  <i class="fas fa-fire"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteProduct(product._id!)" title="Delete">
                  <i class="cil-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="products.length === 0 && !isLoading">
            <td colspan="6" class="text-center">No products found</td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <nav *ngIf="totalPages > 1" aria-label="Product pagination">
        <ul class="pagination justify-content-end">
          <li class="page-item" [class.disabled]="currentPage === 1 || isLoading" (click)="prevPage()">
            <a class="page-link" href="javascript:void(0)">Previous</a>
          </li>

          <li class="page-item" *ngFor="let page of [].constructor(totalPages); let idx = index"
            [class.active]="currentPage === idx + 1" (click)="goToPage(idx + 1)">
            <a class="page-link" href="javascript:void(0)">{{ idx + 1 }}</a>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages || isLoading" (click)="nextPage()">
            <a class="page-link" href="javascript:void(0)">Next</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>